
@*GOOGLEAR CARD BOOTSTRAP 5*@


@section Estilos {

    <link href="https://cdn.datatables.net/responsive/2.1.1/css/responsive.bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet" />
        
         
    @* Fechado para testes *@

    @*ESTILOS DE BOTONES*@
       <link href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.dataTables.min.css"  rel="stylesheet">        

    @*filter columns*@
       <link href="https://cdn.datatables.net/fixedheader/3.2.2/css/fixedHeader.dataTables.min.css"  rel="stylesheet" /> 
   
        <style>

        thead input {
            width: 100%;
            background-color: #FFFFCC !important
        }

        .btn-exportar-excel {
            background-color: #198754 !important;
            color: white !important;
        }

        .btn-exportar-pdf {
            background-color: #dc3545 !important;
            color: white !important;
        }

        .btn-exportar-print {
            background-color: #00a7c9 !important;
            color: white !important;
        }
        
    </style>
}



<div class="card">
  <div class="card-header">
    Equipes
  </div>
  <div class="card-body">

      <div class="row">
          <div class="col-sm-12">

              
              <table class="display" id="tb_equipes" style="width:100%">
                  <thead>
                    <tr>
                      <th>Id</th>
                      <th>Equipe</th>
                      <th>Sigla</th>
                      <th>Escudo</th>
                      <th>Tipo</th> 
                      <th>Uf</th>
                      <th>Editar </th>
                      <th>Deletar </th>

                    </tr>
                  </thead>                 
                </table>

          </div>
      </div>


  </div>
</div>

@section Scripts
{

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap4.min.js "></script> 
      
    @* fechado em testes *@

    @* SCRIPTS DE BOTONES *@
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>   

    @*excel*@
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>   
 
    @*pdf*@
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>   
 
    @*imprimir*@
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.print.min.js"></script>  
 

    @*filter columns*@
    <script src="https://cdn.datatables.net/fixedheader/3.2.2/js/dataTables.fixedHeader.min.js"></script>
   

    <script>

        $(document).ready(function () {

            $("#tb_equipes").DataTable({
            
                /*
                "processing": true, // for show progress bar
                "serverSide": true, // for process server side
                "filter": true, // this is for disable filter (search box)
                "orderMulti": false, // for disable multiple column at once
                
              
                "ajax": {
                    "url": "/Equipe/BuscaEquipes",
                    "type": "POST",
                    "datatype": "json"
                },                    
                */
                //"order":
                "ajax": {
                    "url": '@Url.Action("ListaEquipes", "Equipe")',
                    "type": "GET",
                    "datatype": "json"
                },
              

                "columnDefs": [{
                    "targets": [0],
                    "visible": false,
                    "searchable": false
                }],
                       order: [[ 1, 'asc' ]], // Ordena pela coluna de índice 1 (Nome) em ordem ascendente ('asc')
                "columns": [

                    { "data": "id" },
                    { "data": "nome" },
                    { "data": "sigla" },

                    {
                      "data": "escudo", // Nome da propriedade que contém a URL da imagem
                      "render": function (data, type, row) {
                                return '<img src="/images/' + data + '" alt="' + row.nome + '"height="30" width="30">'; // Exibe a imagem
                       }
                    },    //    <img src="/images/item.Escudo" style="height: 30px; width: 30px" />

                    { "data": "tipo"  },
                    { "data": "uf.sigla" },
                   
                    {
                        data: null,
                        render: function (data, type, row) {
                            const url = `/Equipe/Edit/${encodeURI(row.id)}`;
                            return `<a href="${url}" class="btn btn-info">Editar</a>`;
                        }

                    },

                    {

                        data: null,
                        render: function (data, type, row) {
                            return "<a href='#' class='btn btn-danger' onclick=DeleteData('" + row.id + "');>Delete</a>";
                        }
                    },
                ],

               //________________ SEGUNDO ____________
                language: {
                url: "https://cdn.datatables.net/plug-ins/1.11.5/i18n/pt-BR.json"
                },
                //________________ TERCERO ____________
                columnDefs: [
                    {
                        targets: 0,
                        visible: false
                    }
                ],
                //_______________ CUARTO ______________
                dom: 'Bfrtip',
                buttons:
                    [
                        //'excel',
                        {
                            extend: 'excelHtml5',
                            text: 'Exportar Excel',
                            filename: 'Reporte Ufs',
                            title: '',
                            exportOptions: {
                                columns: [0, 1, 2]
                            },
                            className: 'btn-exportar-excel',
                        },
                        //'pdf',
                        {
                            extend: 'pdfHtml5',
                            text: 'Exportar PDF',
                            filename: 'Reporte Ufs',
                            title: '',
                            exportOptions: {
                                columns: [0, 1, 2]
                            },
                            className: 'btn-exportar-pdf',
                        },
                        //'print'
                        {
                            extend: 'print',
                            title: '',
                            exportOptions: {
                                columns: [0, 1, 2]
                            },
                            className: 'btn-exportar-print'

                        },

                        //extra
                        'pageLength'
                    ],

                //______________ QUINTO _______________
                orderCellsTop: true,
                fixedHeader: true,
                initComplete: function () {
                    var api = this.api();

                    // For each column
                    api.columns().eq(0).each(function (colIdx) {

                        // Set the header cell to contain the input element
                        var cell = $('.filters th').eq($(api.column(colIdx).header()).index());

                        var title = $(cell).text();

                        //$(cell).html('<input type="text" placeholder="' + title + '" />');
                        $(cell).html('<input type="text" placeholder="Buscar..." />');

                        // On every keypress in this input
                        $('input', $('.filters th').eq($(api.column(colIdx).header()).index())).off('keyup change').on('keyup change', function (e) {

                            e.stopPropagation();

                            // Get the search value
                            $(this).attr('title', $(this).val());
                            var regexr = '({search})'; //$(this).parents('th').find('select').val();

                            var cursorPosition = this.selectionStart;
                            // Search the column for that value
                            api
                                .column(colIdx)
                                .search(
                                    this.value != ''
                                        ? regexr.replace('{search}', '(((' + this.value + ')))')
                                        : '',
                                    this.value != '',
                                    this.value == ''
                                )
                                .draw();

                            $(this)
                                .focus()[0]
                                .setSelectionRange(cursorPosition, cursorPosition);
                        });
                    });
                },

                //extra
                //searching: false
            });
        });

        /*
        $(document).ready(function () {
                    

          if (id) {
                  // Encontrar a linha da tabela com o ID correspondente
                  var linha = $("#tb_equipe").find("tr[data-id='" + id + "']");

                  if (linha.length > 0) {
                // Rolar a página até a linha
                $('html, body').animate({
                    scrollTop: linha.offset().top
                }, 500); // 500ms é a duração da animação
                  }
              }
        });
        */

       
        function DeleteData(Id) {
            if (confirm("Realmente deseja DELETAR a Equipe ? ")) {
                event.preventDefault(); // Impedir comportamento padrão
                Delete(Id);
            } else {
                return false;
            }

            return false; // Retornar false
        }

        function Delete(Id) {
            var url = `/Equipe/Delete/${Id}`; // URL com o ID
            //var url = "/Estadio/Delete/"; // URL relativa
            try {
                $.ajax({
                    url: url,
                    type: "POST", // Ou "DELETE" , se o seu action esperar DELETE
                    datatype: "json",
                    headers: {
                        "RequestVerificationToken": $('input[name="__RequestVerificationToken"]').val()
                    },
                    //data: { id: Id }, 
                    success: function (data) {
                        if (data) {
                            oTable = $('#tb_equipes').DataTable();
                            oTable.draw();
                        } else {
                            alert("Ocorreu algum PROBLEMA !!");
                        }
                    },
                    error: function (error) {
                        alert("Ocorreu um erro na requisição: " + error.message);
                    }
                });
            } catch (error) {
                alert(" Ocorreu um erro: " + error.message);
            }
        }

        
    </script>
}

